<html>
<head>
		<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
        <script src="bower_components/jquery/jquery.js"></script>
</head>
<body>
	<script type="text/javascript">

		var oRawData = {};
		var oResult = {};

		$.get("data/bdlMitglieder.csv", function(oData) {
		    oRawData = csvJSON(oData);
		    convertToInternalFormat(oRawData);
		    $("code").text(JSON.stringify(oResult, null, "\t"));
		});

		function convertToInternalFormat(oRawData){
			for (var i = 0; i < oRawData.length; i++) {
				var oLine = oRawData[i];
				if (oLine.Verein && oLine.Name && oLine.Vorname && oLine.Passnummer) {
					if (oResult[oLine.Verein] == undefined) {
						var uid = generateUIDNotMoreThan1million();
						oResult[oLine.Verein] = {
							"vereinsUID" : uid,
							"mitglieder" : []
						};
					}
					oResult[oLine.Verein].mitglieder.push({
						"name" : oLine.Name,
						"vorname" : oLine.Vorname,
						"passnummer" : oLine.Passnummer.replace(/[^0-9]+/g, '')
					});
				}
			};
		};

		function generateUIDNotMoreThan1million() {
		    return ("0000" + (Math.random()*Math.pow(36,4) << 0).toString(36)).slice(-4)
		}
		//var csv is the CSV file with headers
		function csvJSON(csv){
		  var lines=csv.split("\r\n");
		  var result = [];
		  var headers=lines[0].split(";");
		 
		  for(var i=1;i<lines.length;i++){
		 
			  var obj = {};
			  var currentline=lines[i].split(";");
		 
			  for(var j=0;j<headers.length;j++){
				  obj[headers[j]] = currentline[j];
			  }
			  result.push(obj);
		  };
		  return result;
		}
	</script>

	  <pre>
		<code id="code"></code>
	  </pre>
</body>
</html>
