<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/Autocomplete.css">
    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/modernizr/modernizr.js"></script>
    <script src="bower_components/autocomplete/Autocomplete.js"></script>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
</head>
<body>

<div id="hiddenInputFieldContainer" style="visibility:hidden; position:absolute; width:0px; height:0px">
  <div id="inputsForSingleHome">
    <select id="name1" name="name1" style="width:150px"></select>
    <a id="linkmore1" onclick="switchMore('more1', $('#linkmore1').text().indexOf('More') != -1)" />More +</a>
    <div class="spacer"></div>
    <div id="more1" class="more">
      <input id="sl1" name="sl1" type="text" pattern="\d*" size="3" placeholder="SL">
      <input id="hf1" name="hf1" type="text" pattern="\d*" size="3" placeholder="HF">
      <input id="i180er1" name="i180er1" type="text" pattern="\d*" size="3" placeholder="180er">
    </div>
  </div>
      
  <div id="inputsForSingleGuest">
    <select id="name2" name="name2" style="width:150px"></select>
    <a id="linkmore2" onclick="switchMore('more2', $('#linkmore2').text().indexOf('More') != -1)" />More +</a>
    <div id="more2" class="more">
      <input id="sl2" name="sl2" type="text" pattern="\d*" size="3" placeholder="SL">
      <input id="hf2" name="hf2" type="text" pattern="\d*" size="3" placeholder="HF">
      <input id="i180er2" name="i180er2" type="text" pattern="\d*" size="3" placeholder="180er">
    </div>
  </div>

  <div id="inputsForDoubleHome">
    <select id="heimname1" name="heimname1" style="width:150px"></select>
    <a id="linkdmore1" onclick="switchMore('dmore1', $('#linkdmore1').text().indexOf('More') != -1)" />More +</a>
    <div id="dmore1" class="more">
      <input id="dsl1" name="dsl1" type="text" pattern="\d*" size="3" placeholder="SL">
      <input id="dhf1" name="dhf1" type="text" pattern="\d*" size="3" placeholder="HF">
      <input id="di180er1" name="di180er1" type="text" pattern="\d*" size="3" placeholder="180er">
    </div>
    <div class="spacer"></div>
    <select id="heimname2" name="heimname2" style="width:150px"></select>
    <a id="linkdmore2" onclick="switchMore('dmore2', $('#linkdmore2').text().indexOf('More') != -1)" />More +</a>
    <div id="dmore2" class="more">
      <input id="dhf2" name="dhf2" type="text" pattern="\d*" size="3" placeholder="HF">
      <input id="di180er2" name="di180er2" type="text" pattern="\d*" size="3" placeholder="180er">
    </div>
    <div class="spacer"></div>
  </div>  

  <div id="inputsForDoubleGuest">
    <select id="gastname1" name="gastname1" style="width:150px"></select>
    <a id="linkdmore3" onclick="switchMore('dmore3', $('#linkdmore3').text().indexOf('More') != -1)" />More +</a>
    <div id="dmore3" class="more">
      <input id="dsl2" name="dsl2" type="text" pattern="\d*" size="3" placeholder="SL">
      <input id="dhf3" name="dhf3" type="text" pattern="\d*" size="3" placeholder="HF">
      <input id="di180er3" name="di180er3" type="text" pattern="\d*" size="3" placeholder="180er">
    </div>
    <div class="spacer"></div>
    <select id="gastname2" name="gastname2" style="width:150px"></select>
    <a id="linkdmore4" onclick="switchMore('dmore4', $('#linkdmore4').text().indexOf('More') != -1)" />More +</a>
    <div id="dmore4" class="more">
      <input id="dhf4" name="dhf4" type="text" pattern="\d*" size="3" placeholder="HF">
      <input id="di180er4" name="di180er4" type="text" pattern="\d*" size="3" placeholder="180er">
    </div>
    <div class="spacer"></div>
  </div>  

</div>

<div class="container">

  <h3>BDL Online Spielberichtsbogen</h3>

  <div id="partie"></div>
  
    <form action="index2.html" method="get">
      <input id="heim" name="heim" type="hidden">
      <input id="gast" name="gast" type="hidden">
        <table class="table table-stripped table-condensed">
          <tr>
            <td>
              <div class="smaller">Einzel Block 1<br>
                <input type="radio" name="spiel" value="e1b1" onclick="enableFormForSingles(true)"> Einzel 1<br>
                <input type="radio" name="spiel" value="e2b1" onclick="enableFormForSingles(true)"> Einzel 2<br>
                <input type="radio" name="spiel" value="e3b1" onclick="enableFormForSingles(true)"> Einzel 3<br>
                <input type="radio" name="spiel" value="e4b1" onclick="enableFormForSingles(true)"> Einzel 4
              </div>
            </td>
            <td>
              <div class="smaller">Doppel Block 2</div>
              <input type="radio" name="spiel" value="d1b2" onclick="enableFormForSingles(false)"> Doppel 1<br>
              <input type="radio" name="spiel" value="d2b2" onclick="enableFormForSingles(false)"> Doppel 2<br>
            </td>
            <td>
              <div class="smaller">Einzel Block 3</div>
              <input type="radio" name="spiel" value="e1b3" onclick="enableFormForSingles(true)"> Einzel 1<br>
              <input type="radio" name="spiel" value="e2b3" onclick="enableFormForSingles(true)"> Einzel 2<br>
              <input type="radio" name="spiel" value="e3b3" onclick="enableFormForSingles(true)"> Einzel 3<br>
              <input type="radio" name="spiel" value="e4b4" onclick="enableFormForSingles(true)"> Einzel 4<br>
            </td>
            <td>
              <div class="smaller">Doppel Block 4</div>
              <input type="radio" name="spiel" value="d1b4" onclick="enableFormForSingles(false)"> Doppel 1<br>
              <input type="radio" name="spiel" value="d2b4" onclick="enableFormForSingles(false)"> Doppel 2<br>
            </td>
          </tr>
        </table>

          <hr>
          <div id="spielerHeim"></div>
          <div id="ergSelection" style="visibility:hidden">
            <select id="erg1" name="erg1">  
              <option>0</option>
              <option>1</option>
              <option>2</option>
              <option>3</option>
            </select> : <select id="erg2" name="erg2">  
              <option>0</option>
              <option>1</option>
              <option>2</option>
              <option>3</option>
            </select>
          </div>
          <div class="spacer"></div>
          <div id="spielerGast"></div>
          <div class="spacer"></div>
          <input id="speichern" type="submit" name="speichern" value="Speichern"  >
    </form>

    <hr>

<table id="summaryTable" class="table table-stripped table-condensed">
   <tr>
      <th>Name</th>
      <th>Ergebnis</th>
      <th>Name</th>
   </tr>
</table>

<hr>

<input type="file" capture="camera" accept="image/*" id="takePictureField">

<p>&copy; Badische Dart Liga - BDL - http://www.badischedartliga.de</p>

<script data-main="scripts/main" src="bower_components/requirejs/require.js"></script>
<script src="scripts/async.localStorage.js"></script>
<script src="scripts/async.localStorage.examples.js"></script>
<script src="scripts/fullscreensnippet.js"></script>
<script type="text/javascript">
  
  function getUrlParameter(sParam){
      var sReturn = "";
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split('&');
      for (var i = 0; i < sURLVariables.length; i++) {
          var sParameterName = sURLVariables[i].split('=');
          if (sParameterName[0] == sParam) {
            sReturn = sParameterName[1];
          }
      }
      return sReturn;
  };

  var heim = getUrlParameter("heim").replace(/\+/g,' ');
  var gast = getUrlParameter("gast").replace(/\+/g,' ');
  var spiel = getUrlParameter("spiel").replace(/\+/g,' ');
  var aVereine = [];
  
  document.getElementById("speichern").disabled = true;

  var ergebnisse = JSON.parse(window.localStorage.getItem("ergebnisse"));

  if (ergebnisse) {
    readNewGameFromURL(ergebnisse, spiel);
    window.localStorage.setItem("ergebnisse", JSON.stringify(ergebnisse));
    printTable(ergebnisse);
  } else {
    $.getJSON("data/ergebnisse.json", function(ergebnisse) {
      ergebnisse.heim = heim;
      ergebnisse.gast = gast;

      readNewGameFromURL(ergebnisse, spiel);

      window.localStorage.setItem("ergebnisse", JSON.stringify(ergebnisse));

      printTable(ergebnisse);
    });
  }

  $.getJSON("data/vereine.json", function(oVereine) {
    debugger;

    var heimSelectS = $('#name1');
    var heimSelectD1 = $('#heimname1');
    var heimSelectD2 = $('#heimname2');
    for (var i in oVereine[heim]) {
       heimSelectS.append($('<option></option>').html(oVereine[heim][i]));
       heimSelectD1.append($('<option></option>').html(oVereine[heim][i]));
       heimSelectD2.append($('<option></option>').html(oVereine[heim][i]));
    }

    var gastSelectS = $('#name2');
    var gastSelectD1 = $('#gastname1');
    var gastSelectD2 = $('#gastname2');
    for (var i in mVereine[gast]) {
       gastSelectS.append($('<option></option>').html(oVereine[gast][i]));
       gastSelectD1.append($('<option></option>').html(oVereine[gast][i]));
       gastSelectD2.append($('<option></option>').html(oVereine[gast][i]));
    }
  });

  function printTable(ergebnisse) {
    for (var erg in ergebnisse) {
      if (ergebnisse[erg].spieler1 && ergebnisse[erg].spieler2) {
        var line = "<tr>"+
                      "<td>" + ergebnisse[erg].spieler1.name + "<br>\n"+
                      "  <div class=\"smaller\">SL: " + ergebnisse[erg].spieler1.shortlegs + " | HF: " + ergebnisse[erg].spieler1.highfinishes + " | 180er : " + ergebnisse[erg].spieler1.i180er + "</div>\n"+
                      "</td>\n"+
                      "<td>" + ergebnisse[erg].spieler1.legs + " : " + ergebnisse[erg].spieler2.legs + "</td>\n"+
                      "<td>" + ergebnisse[erg].spieler2.name + "<br>\n"+
                      "  <div class=\"smaller\">SL: " + ergebnisse[erg].spieler2.shortlegs + " | HF: " + ergebnisse[erg].spieler2.highfinishes + " | 180er : " + ergebnisse[erg].spieler2.i180er + "</div>\n"+
                      "</td>\n"+
                   "</tr>";
        $('#summaryTable tr:last').after(line);
      } else if (ergebnisse[erg].paar1 && ergebnisse[erg].paar2) {
        var line = 
          "<tr>"
              + "<td>" 
                + ergebnisse[erg].paar1.spieler1.name + "<br>\n"
                + "<div class=\"smaller\">HF: " + ergebnisse[erg].paar1.spieler1.highfinishes + " | 180er : " + ergebnisse[erg].paar1.spieler1.i180er + "</div>\n"
                + ergebnisse[erg].paar1.spieler2.name + "<br>\n"
                + "<div class=\"smaller\">HF: " + ergebnisse[erg].paar1.spieler2.highfinishes + " | 180er : " + ergebnisse[erg].paar1.spieler2.i180er + "</div>\n"
                + "<div class=\"smaller\">TEAM SL: " + ergebnisse[erg].paar1.shortlegs + "</div>\n"
              + "</td>\n"
              + "<td>" + ergebnisse[erg].paar1.legs + " : " + ergebnisse[erg].paar2.legs + "</td>\n"
              + "<td>"
                + ergebnisse[erg].paar2.spieler1.name + "<br>\n"
                + "<div class=\"smaller\">HF: " + ergebnisse[erg].paar2.spieler1.highfinishes + " | 180er : " + ergebnisse[erg].paar2.spieler1.i180er + "</div>\n"
                + ergebnisse[erg].paar2.spieler2.name + "<br>\n"
                + "<div class=\"smaller\">HF: " + ergebnisse[erg].paar2.spieler2.highfinishes + " | 180er : " + ergebnisse[erg].paar2.spieler2.i180er + "</div>\n"
                + "<div class=\"smaller\">TEAM SL: " + ergebnisse[erg].paar2.shortlegs + "</div>\n"
              + "</td>\n"
           + "</tr>";
        $('#summaryTable tr:last').after(line);
      }
    }
  };

  function readNewGameFromURL(ergebnisse, spiel) {
    if (!spiel) {
      return;
    }

    if (ergebnisse[spiel].spieler1) {
      ergebnisse[spiel].spieler1 = { 
        "name" : getUrlParameter("name1").replace(/\+/g,' '), 
        "legs" : getUrlParameter("erg1") || 0, 
        "shortlegs" : getUrlParameter("sl1") || 0, 
        "highfinishes" : getUrlParameter("hf1") || 0, 
        "i180er" : getUrlParameter("i180er1") || 0 
      };
    };

    if (ergebnisse[spiel].spieler2) {
      ergebnisse[spiel].spieler2 = { 
        "name" : getUrlParameter("name2").replace(/\+/g,' '), 
        "legs" : getUrlParameter("erg2") || 0, 
        "shortlegs" : getUrlParameter("sl2") || 0, 
        "highfinishes" : getUrlParameter("hf2") || 0, 
        "i180er" : getUrlParameter("i180er2") || 0 
      };
    };
    
    if (ergebnisse[spiel].paar1) {
      ergebnisse[spiel].paar1 = { 
        "legs" : getUrlParameter("erg1") || 0,
        "shortlegs" : getUrlParameter("dsl1") || 0,
        "spieler1" : {
          "name" : getUrlParameter("heimname1").replace(/\+/g,' '), 
          "highfinishes" : getUrlParameter("dhf1") || 0,
          "i180er" : getUrlParameter("di180er1") || 0
        },
        "spieler2" : {
          "name" : getUrlParameter("heimname2").replace(/\+/g,' '), 
          "highfinishes" : getUrlParameter("dhf2") || 0,
          "i180er" : getUrlParameter("di180er2") || 0
        }
      };
    };

    if (ergebnisse[spiel].paar2) {
      ergebnisse[spiel].paar2 = { 
        "legs" : getUrlParameter("erg2") || 0,
        "shortlegs" : getUrlParameter("dsl2") || 0,
        "spieler1" : {
          "name" : getUrlParameter("gastname1").replace(/\+/g,' '), 
          "highfinishes" : getUrlParameter("dhf3") || 0,
          "i180er" : getUrlParameter("di180er3") || 0
        },
        "spieler2" : {
          "name" : getUrlParameter("gastname2").replace(/\+/g,' '), 
          "highfinishes" : getUrlParameter("dhf4") || 0,
          "i180er" : getUrlParameter("di180er4") || 0
        }
      };
    };
  };

  function enableFormForSingles(bSingles) {
    document.getElementById("speichern").disabled = false;
    $("#ergSelection").css("visibility","visible"); 
    $("#spielerHeim > #inputsForSingleHome").appendTo("#hiddenInputFieldContainer");
    $("#spielerHeim > #inputsForDoubleHome").appendTo("#hiddenInputFieldContainer");
    $("#spielerGast > #inputsForSingleGuest").appendTo("#hiddenInputFieldContainer");
    $("#spielerGast > #inputsForDoubleGuest").appendTo("#hiddenInputFieldContainer");
    
    if (bSingles) {
      $("#hiddenInputFieldContainer > #inputsForSingleHome").appendTo("#spielerHeim");  
      $("#hiddenInputFieldContainer > #inputsForSingleGuest").appendTo("#spielerGast");  
    } else {
      $("#hiddenInputFieldContainer > #inputsForDoubleHome").appendTo("#spielerHeim");  
      $("#hiddenInputFieldContainer > #inputsForDoubleGuest").appendTo("#spielerGast");  
    }
  };

  function switchMore(sId, bShow, duration) {
    if (bShow) {
      if (duration == 0) {
        jQuery("#" + sId).show();
      } else {
        jQuery("#" + sId).show(200);
      }
      jQuery("#link" + sId).text("Less -");
    } else {
      if (duration == 0) {
        jQuery("#" + sId).hide();
      } else {
        jQuery("#" + sId).hide(200);
      }
      jQuery("#link" + sId).text("More +");
    }
  };

  switchMore("more1", false, 0);
  switchMore("more2", false, 0);
  switchMore("dmore1", false, 0);
  switchMore("dmore2", false, 0);
  switchMore("dmore3", false, 0);
  switchMore("dmore4", false, 0);
  $("#partie").text("Partie: " + heim + " vs. " + gast);
  $("#heim").val(heim);
  $("#gast").val(gast);
  

</script>

</body>
</html>
